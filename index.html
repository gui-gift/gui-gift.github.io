<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>在线交流</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			background-color: #f2f2f2;
		}
		h1 {
			text-align: center;
			margin-top: 50px;
		}
		form {
			margin: 50px auto;
			width: 80%;
			max-width: 600px;
			background-color: #fff;
			padding: 20px;
			border-radius: 5px;
			box-shadow: 0 0 10px rgba(0,0,0,0.2);
		}
		label {
			display: block;
			margin-bottom: 10px;
			font-weight: bold;
		}
		input[type="text"], textarea {
			width: 100%;
			padding: 10px;
			border: none;
			border-radius: 5px;
			box-shadow: 0 0 5px rgba(0,0,0,0.1);
			margin-bottom: 20px;
			font-size: 16px;
		}
		input[type="submit"] {
			background-color: #4CAF50;
			color: #fff;
			padding: 10px 20px;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			font-size: 16px;
		}
		input[type="submit"]:hover {
			background-color: #3e8e41;
		}
		.messages {
			margin: 50px auto;
			width: 80%;
			max-width: 600px;
			background-color: #fff;
			padding: 20px;
			border-radius: 5px;
			box-shadow: 0 0 10px rgba(0,0,0,0.2);
		}
		.message {
			margin-bottom: 10px;
			padding-bottom: 10px;
			border-bottom: 1px solid #ccc;
		}
		.message p {
			margin: 0;
			font-size: 16px;
		}
		.message span {
			font-weight: bold;
			margin-right: 10px;
		}
	</style>
</head>
<body>
	<h1>在线交流</h1>
	<form id="message-form">
		<label for="name">姓名</label>
		<input type="text" id="name" name="name" required>
		<label for="message">留言</label>
		<textarea id="message" name="message" rows="5" required></textarea>
		<input type="submit" value="发送">
	</form>
	<div class="messages" id="messages">
		<!-- 这里将显示留言 -->
	</div>
	<script>
		// 获取表单和留言列表
		const form = document.getElementById('message-form');
		const messages = document.getElementById('messages');

		// 当表单提交时，发送留言到服务器
		form.addEventListener('submit', (event) => {
			event.preventDefault(); // 阻止表单默认提交行为

			// 获取表单数据
			const name = form.elements.name.value;
			const message = form.elements.message.value;

			// 发送POST请求到服务器
			fetch('/api/messages', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({ name, message })
			})
			.then(response => response.json())
			.then(data => {
				// 清空表单
				form.reset();

				// 添加新留言到留言列表
				const messageElement = document.createElement('div');
				messageElement.classList.add('message');
				messageElement.innerHTML = `
					<p><span>${data.name}:</span> ${data.message}</p>
				`;
				messages.appendChild(messageElement);
			})
			.catch(error => {
				console.error(error);
				alert('发送留言失败，请稍后再试。');
			});
		});

		// 页面加载时，获取所有留言并显示到留言列表
		fetch('/api/messages')
		.then(response => response.json())
		.then(data => {
			data.forEach(message => {
				const messageElement = document.createElement('div');
				messageElement.classList.add('message');
				messageElement.innerHTML = `
					<p><span>${message.name}:</span> ${message.message}</p>
				`;
				messages.appendChild(messageElement);
			});
		})
		.catch(error => {
			console.error(error);
			alert('获取留言失败，请稍后再试。');
		});
	</script>
</body>
</html>
